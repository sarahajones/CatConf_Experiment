<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CatConf-Experiment</title>

    <!--jsPsych-->
    <script src="jspsych-6.1.0/jspsych.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-image-button-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-same-different-image.js"></script>
    <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css">

    <!--jQuery and jQuery plugins -->
    <script src="scripts/external/jquery-3.4.1.min.js"></script>
    <script src="scripts/external/jquery-3.4.1.js"></script>
    <script src="scripts/external/jquery.mousewheel.min.js"></script>
    <script src="scripts/external/jquery.scrollify.js"></script>

    <!--custom JS: trials-->
    <script src="scripts/jspsych-PIS.js"></script>
    <script src="scripts/jspsych-consent.js"></script>
    <script src="scripts/jspsych-tutorial.js"></script>
    <script src="scripts/jspsych-quickfire.js"></script>
    <script src="scripts/jspsych-experimentscreen.js"></script>

    <script src="scripts/trial.js"></script>
    <script src="scripts/helper-functions.js"></script>
    <script src="scripts/box-muller.js"></script>
    <script src="scripts/gaussian.js"></script>

    <!--custom CSS-->
    <link href="CSS/styles.css" rel="stylesheet" type="text/css">
    <link href="CSS/experimentscreen.css" rel="stylesheet" type="text/css">

</head>

<body class="main">

<script>

    /* EXPERIMENT INFORMATION */
    var CUREC_studyName = 'An investigation into decision confidence and category choices';
    var CUREC_ID = '___________';
    var PIS_version = '1.0';
    var PIS_date = 'March 2020';
    var consent_version = '1.0';
    var consent_date = 'March 2020';

    /* PreLOAD IMAGES FOR SPEED */
    var images = [
        'images/oxford-logo.jpg' +
        'images/checkmark-black.svg' +
        'images/checkmark-white.svg' +
        'images/space_invaders.png' +
        'images/green_spaceship.png' +
        'images/blue_spaceship.png' +
        'images/orange_spaceship.png' +
        'images/bomb.png' +
        'images/coins.png'
    ];

    var dataObject = {
        CUREC_ID: CUREC_ID,
        PIS_version: PIS_version,
        PIS_date: PIS_date,
        PIS_acknowledged: undefined,
        consent_version: consent_version,
        consent_date: consent_date,
        consented: undefined,
    };
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    /* EXPERIMENTAL PAGES */
    // PIS
    var PIS = {
        type: 'jspsych-PIS',
        studyName: CUREC_studyName,
        CUREC_ID: CUREC_ID,
        version: PIS_version,
        date: PIS_date
    };

    var consent = {
        type: 'jspsych-consent',
        studyName: CUREC_studyName,
        CUREC_ID: CUREC_ID,
        version: consent_version,
        date: consent_date
    };
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    /* TRAINING AND INSTRUCTION*/
    var tutorial_1 = {
        type: "jspsych-tutorial",
        isFirstTime: true
    };

    var tutorial_2 = {
        type: "jspsych-tutorial",
        isFirstTime: false
    };
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    /* EXPERIMENT TIMELINE*/
    const timeline = [
        PIS,
        consent,
        tutorial_1,
        tutorial_2,
    ];
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////
    /*QUICK FIRE ROUND*/
    const trial_number = 2; // No magic numbers! :)

    // construct deck
    quickfire_stimuli = [
        'images/orange_spaceship.png',
        'images/blue_spaceship.png'
    ];

    const deck_count = trial_number / quickfire_stimuli.length;

    // shuffle deck
    quickfire_stimuli = shuffle_shoe(quickfire_stimuli, deck_count);

    let trial_contents = quickfire_stimuli.map(
        s => {
            const outcome_chance = 1;
            const good = 'images/coins.png';
            const bad = 'images/bomb.png';
            let r;

            if(/orange/i.test(s)) {
                r = Math.random() < outcome_chance ? good : bad;
            } else if(/blue/i.test(s)) {
                r = Math.random() > outcome_chance ? good : bad;
            } else {
                console.warn(`Unrecognised spaceship colour in ${s}.`);
                return;
            }
            return {
                stimulus: s,
                result: r
            }
        });

    for(let i=1; i <= trial_number; i++) {
        const trial_details = trial_contents.pop();
        timeline.push({
            type: 'jspsych-quickfire',
            stimuli: [trial_details.stimulus, 'images/package_image.png'],
            feedback: trial_details.result,
            trial_number: i,
            choices: ['Retrieve', 'Zap'],
            stimulus1_duration: 1500,
            gap_duration: 0,
            stimulus2_duration: 1500,
            trial_duration: 5000,
            feedback_duration: 2000,
            response_ends_trial: false,
        });
    }
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////
    /*TEST TRIALS*/
    /*const drop_number = 4; //amount of drops

    //var gaussian = require('gaussian');
    
    const var1 = 2; //variance of 1st spaceship
    const mu1 = 100; //mu of 1st spaceship is 100
    const var2 = 4;
    const mu2 = 150;

    const normDist = new NormalDistribution(mean, standardDeviation);
    dropTrials_stimuli = [
        'images/orange_spaceship.png',
        'images/blue_spaceship.png'
    ];
    const deck_count1 = drop_number / dropTrials_stimuli.length;
    // shuffle deck
    dropTrials_stimuli = shuffle_shoe(dropTrials_stimuli, deck_count1);

    xPosition1 = [100,200,300,400];

    let trial_contents1 = dropTrials_stimuli.map(
        s => {
            let x = Math.random()
            return {
                xPosition1: x,
                stimulus: dropTrials_stimuli,
            }
        });

    for(let i=1; i <= drop_number; i++) {
        const trial_details = trial_contents1.pop();
        timeline.push({
            type: "jspsych-experimentscreen",
            xPosition1st: trial_details.xPosition1,
            choices: ['Retrieve', 'Zap'],
        });
    }


    /* start the experiment */
    jsPsych.init({
        timeline: timeline,
    })


</script>
</body>
</html>